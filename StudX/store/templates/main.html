{% extends 'base.html' %}
{% load static %}
{% block content %}
<!-- Hero Section with Swiper -->
<section class="hero-section">
    <div class="swiper mySwiper">
        <div class="swiper-wrapper">
            <div class="swiper-slide"><a href="{% url 'search' %}?q=Books"> <img src="{% static 'assests/slide1.png' %}"
                                                                                 alt="Slide 1"
                                                                                 style="cursor: pointer;"></a>
            </div>
            <div class="swiper-slide"><img src="{% static 'assests/slide2.png' %}" alt="Slide 2"
                                           onclick="scrollToSection('romm-section')" style="cursor: pointer;"></div>
            <div class="swiper-slide"><a href="{% url 'search' %}?q=Electronics"> <img
                    src="{% static 'assests/slide3.png' %}" alt="Slide 3"></a></div>
            <div class="swiper-slide" onclick="loadSaleProducts()"><img src="{% static 'assests/slide4.png' %}"
                                                                        alt="Slide 4" style="cursor: pointer;"></div>
            <div class="swiper-slide"><img src="{% static 'assests/slide5.png' %}" alt="Slide 5"
                                           onclick="redirectToSellerForm()"
                                           style="cursor: pointer;"></div>
            <div class="swiper-slide"><img src="{% static 'assests/slide6.png' %}" alt="Slide 6"
                                           onclick="redirectToAddRoom()"
                                           style="cursor: pointer;">

            </div>
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-pagination"></div>
    </div>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
</section>

<!-- Products Section -->
<section id="products-section">
    <div class="form-container">
        <!-- Categories Section -->
        <div class="categories-container">
            <h2 class="categories-title">Categories</h2>
            <div class="categories-list">
                <button class="category-button all-button">All</button>
                <button class="category-button" data-category="Academic Tools">Academic Tools</button>
                <button class="category-button" data-category="Electronics">Electronics</button>
                <button class="category-button" data-category="Books">Books</button>
                <button class="category-button" data-category="Academic Coats">Clothing</button>
                <button class="category-button" data-category="Table">Tables</button>
                <button class="category-button" data-category="Others">Others</button>
            </div>
        </div>

        <!-- Featured Products Section -->
        <div class="products-container">
            <h2 class="section-title">Featured Products</h2>

            <!-- Product Listing -->
            <div id="product-container" class="product-container">
                {% for product in products %}
                <div class="product-card">
                    <img alt="{{ product.name }}" class="product-image" src="{{ product.image.url }}">
                    <h3 class="product-title">{{ product.name }}</h3>
                    <h5 class="product-location">
                        <i class="fa-solid fa-map-marker-alt"></i> {{ product.seller.seller_details.address }}
                    </h5>
                    <a class="view-button" href="{% url 'product' product.id %}">View Product</a>
                </div>
                {% empty %}
                <p class="no-products">No products available at the moment. Please check back later!</p>
                {% endfor %}
            </div>

            <!-- Pagination Controls -->
            <div id="pagination-controls">
                <button id="prev-page" disabled>Prev</button>
                <span id="page-number">1</span>
                <button id="next-page">Next</button>
            </div>
        </div>

    </div>
</section>


<!-- Rooms Section -->
<section id="romm-section">
    <div class="form-container">
        <h2 class="section-title">Available Rooms</h2>
        <div class="product-container">
            {% if rooms.exists %}
            {% for room in rooms %}
            <div class="product-card-room">
                <img alt="{{ room.location }}" class="product-image" src="{{ room.photo.url }}">
                <h3 class="product-title">{{ room.type }}</h3>
                <a class="view-button" href="{% url 'room_details' room.id %}">View Detail</a>

            </div>
            {% endfor %}
            {% else %}
            <p class="no-rooms">No rooms available at the moment. Please check back later!</p>
            {% endif %}
        </div>
    </div>
</section>
<script>
    function loadSaleProducts() {
        window.location.href = "/search/?on_sale=true";
    }

</script>
<script>
    function scrollToSection(sectionId) {
        document.getElementById(sectionId).scrollIntoView({behavior: 'smooth'});
    }
</script>
<script>
    var isAuthenticated = {% if user.is_authenticated %} true {% else %} false {% endif %};

    function redirectToSellerForm() {
        if (isAuthenticated) {
            window.location.href = "/seller_detail/";
        } else {
            window.location.href = "/seller-login-required/";
        }
    }
</script>

<script>
    var isAuthenticated = {% if user.is_authenticated %} true {% else %} false {% endif %};

    function redirectToAddRoom() {
        if (isAuthenticated) {
            window.location.href = "/add_room/";
        } else {
            window.location.href = "/seller-login-required/";
        }
    }
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const categoryButtons = document.querySelectorAll(".category-button");
        const productContainer = document.getElementById("product-container");

        categoryButtons.forEach(button => {
            button.addEventListener("click", function () {
                const category = this.getAttribute("data-category");

                let url = "/filter-products/";
                if (category) {
                    url += `?category=${encodeURIComponent(category)}`;
                }

                fetch(url)
                    .then(response => response.json())
                    .then(data => updateProductList(data))
                    .catch(error => console.error("Error fetching products:", error));
            });
        });

        function updateProductList(data) {
            productContainer.innerHTML = ""; // Clear existing products

            if (data.length === 0) {
                productContainer.innerHTML = "<p class='no-products'>No products available.</p>";
                return;
            }

            data.forEach(product => {
                const productCard = `
                    <div class="product-card">
                        <img alt="${product.name}" class="product-image" src="${product.image_url}">
                        <h3 class="product-title">${product.name}</h3>
                        <h5 class="product-location">
                            <i class="fa-solid fa-map-marker-alt"></i> ${product.location}
                        </h5>
                        <a class="view-button" href="/product/${product.id}">View Product</a>
                    </div>
                `;
                productContainer.innerHTML += productCard;
            });
        }
    });
</script>



<script>
    document.addEventListener("DOMContentLoaded", function () {
        let currentPage = 1;
        const productsPerPage = 10;
        let allProducts = [...document.querySelectorAll(".product-card")];
        let filteredProducts = allProducts;

        function showProducts(page) {
            const start = (page - 1) * productsPerPage;
            const end = start + productsPerPage;

            // Hide all products
            allProducts.forEach(product => product.style.display = "none");

            // Show only products for the current page
            filteredProducts.slice(start, end).forEach(product => product.style.display = "block");

            // Update page number
            document.getElementById("page-number").innerText = page;

            // Enable/Disable pagination buttons
            document.getElementById("prev-page").disabled = page === 1;
            document.getElementById("next-page").disabled = end >= filteredProducts.length;
        }

        // Handle category filtering
        document.querySelectorAll(".category-button").forEach(button => {
            button.addEventListener("click", function () {
                const selectedCategory = button.dataset.category;
                currentPage = 1;


                // Filter products based on category
                filteredProducts = allProducts.filter(product =>
                    product.getAttribute("data-category") === selectedCategory
                );

                // Reset pagination
                showProducts(currentPage);
            });
        });

        // Pagination controls
        document.getElementById("next-page").addEventListener("click", () => {
            if ((currentPage * productsPerPage) < filteredProducts.length) {
                currentPage++;
                showProducts(currentPage);
            }
        });

        document.getElementById("prev-page").addEventListener("click", () => {
            if (currentPage > 1) {
                currentPage--;
                showProducts(currentPage);
            }
        });

        // Initial Load
        showProducts(currentPage);
    });
</script>


{% endblock %}
