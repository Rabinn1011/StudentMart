{% extends 'base.html' %}
{% load static %}
{% block content %}

    <!-- Hero Section with Swiper -->
    <section class="hero-section">
        <div class="swiper mySwiper">
            <div class="swiper-wrapper">
                <div class="swiper-slide"><a href="{% url 'search' %}?q=Books"> <img
                        src="{% static 'assests/slide1.png' %}"
                        alt="Slide 1"
                        style="cursor: pointer;"></a>
                </div>
                <div class="swiper-slide"><img src="{% static 'assests/slide2.png' %}" alt="Slide 2"
                                               onclick="scrollToSection('romm-section')" style="cursor: pointer;"></div>
                <div class="swiper-slide"><a href="{% url 'search' %}?q=Electronics"> <img
                        src="{% static 'assests/slide3.png' %}" alt="Slide 3"></a></div>
                <div class="swiper-slide" onclick="loadSaleProducts()"><img src="{% static 'assests/slide4.png' %}"
                                                                            alt="Slide 4" style="cursor: pointer;">
                </div>
                <div class="swiper-slide"><img src="{% static 'assests/slide5.png' %}" alt="Slide 5"
                                               onclick="redirectToSellerForm()"
                                               style="cursor: pointer;"></div>
                <div class="swiper-slide"><img src="{% static 'assests/slide6.png' %}" alt="Slide 6"
                                               onclick="redirectToAddRoom()"
                                               style="cursor: pointer;">

                </div>
            </div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-pagination"></div>
        </div>

        <!-- Swiper JS -->
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    </section>

    <!-- Products Section -->
    <section id="products-section">
        <div class="form-container">
            <!-- Categories Section -->
            <div class="categories-container">
                <h2 class="categories-title">Categories</h2>
                <div class="categories-list">
                    <button class="category-button all-button">All</button>
                    <button class="category-button" data-category="Academic Tools">Academic Tools</button>
                    <button class="category-button" data-category="Electronics">Electronics</button>
                    <button class="category-button" data-category="Books">Books</button>
                    <button class="category-button" data-category="Academic Coats">Clothing</button>
                    <button class="category-button" data-category="Table">Tables</button>
                    <button class="category-button" data-category="Others">Others</button>
                </div>
            </div>

            <!-- Featured Products Section -->
            <div class="products-container">
                <h2 class="section-title">Featured Products</h2>

                <!-- Product Listing -->
                <div id="product-container" class="product-container">
                    {% for product in products %}
                        <div class="product-card">
                            <div class="product-tags">
                                {% if product.is_sold %}
                                    <span class="product-tag product-tag--soldout">Sold</span>
                                {% elif product.is_sale %}
                                    <span class="product-tag product-tag--sale">Sale</span>
                                {% endif %}
                            </div>

                            <img alt="{{ product.name }}" class="product-image" src="{{ product.image.url }}">
                            <h3 class="product-title">{{ product.name }}</h3>
                            <h5 class="product-location">
                                <i class="fa-solid fa-map-marker-alt"></i> {{ product.seller.seller_details.address }}
                            </h5>
                            <a class="view-button" href="{% url 'product' product.id %}">View Product</a>
                        </div>
                        {% empty %}
                        <p class="no-products">No products available at the moment. Please check back later!</p>
                    {% endfor %}
                </div>

                <!-- Pagination Controls -->
                <div id="pagination-controls">
                    <button id="prev-page" disabled>Prev</button>
                    <span id="page-number">1</span>
                    <button id="next-page">Next</button>
                </div>
            </div>

        </div>
    </section>

    <section class="hero-section">
        <img style="width:100%; max-height: 50vh; " src="{% static 'assests/room-banner.png' %}" alt="room banner">
    </section>


    <!-- Rooms Section -->
    <section id="romm-section">
        <div class="form-container">
            <h2 class="section-title">Available Rooms</h2>
            <div class="product-container">
                {% if rooms.exists %}
                    {% for room in rooms %}
                        <div class="product-card">
                            <img alt="{{ room.location }}" class="product-image" src="{{ room.main_image.url }}">
                            <h3 class="product-title">{{ room.type }}</h3>
                            <a class="view-button" href="{% url 'room_details' room.id %}">View Detail</a>

                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-rooms">No rooms available at the moment. Please check back later!</p>
                {% endif %}
            </div>

            <!-- Pagination Controls -->
            <div id="pagination-controls">
                <button id="prev-page" disabled>Prev</button>
                <span id="page-number">1</span>
                <button id="next-page">Next</button>
            </div>
        </div>
    </section>
    <script>
        function loadSaleProducts() {
            window.location.href = "/search/?on_sale=true";
        }

    </script>
    <script>
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({behavior: 'smooth'});
        }
    </script>
    <script>
        var isAuthenticated = {% if user.is_authenticated %} true {% else %} false {% endif %};

        function redirectToSellerForm() {
            if (isAuthenticated) {
                window.location.href = "/seller_detail/";
            } else {
                window.location.href = "/seller-login-required/";
            }
        }
    </script>

    <script>
        var isAuthenticated = {% if user.is_authenticated %} true {% else %} false {% endif %};

        function redirectToAddRoom() {
            if (isAuthenticated) {
                window.location.href = "/add_room/";
            } else {
                window.location.href = "/seller-login-required/";
            }
        }
    </script>


    <script>

        document.addEventListener("DOMContentLoaded", function () {
            let currentPage = 1;
            let currentCategory = null; // Store selected category

            const productContainer = document.getElementById("product-container");
            const prevButton = document.getElementById("prev-page");
            const nextButton = document.getElementById("next-page");
            const pageNumber = document.getElementById("page-number");

            function fetchProducts(category = null, page = 1) {
                currentPage = page;
                currentCategory = category;  // Update global category

                let url = `/filter-products/?page=${page}`;
                if (category) {
                    url += `&category=${encodeURIComponent(category)}`;
                }

                fetch(url)
                    .then(response => response.json())
                    .then(data => updateProductList(data))
                    .catch(error => console.error("Error fetching products:", error));
            }

            function updateProductList(data) {
                productContainer.innerHTML = ""; // Clear existing products

                if (data.products.length === 0) {
                    productContainer.innerHTML = "<p class='no-products'>No products available.</p>";
                    return;
                }

                data.products.forEach(product => {
                    // Build the tag HTML (Sold takes precedence)
                    let tagHtml = "";
                    if (product.is_sold) {
                        tagHtml = `<span class="product-tag product-tag--soldout">Sold</span>`;
                    } else if (product.is_sale) {
                        tagHtml = `<span class="product-tag product-tag--sale">Sale</span>`;
                    }

                    const productCard = `
          <div class="product-card">
            <div class="product-tags">
              ${tagHtml}
            </div>
            <img alt="${product.name}" class="product-image" src="${product.image_url}">
            <h3 class="product-title">${product.name}</h3>
            <h5 class="product-location">
              <i class="fa-solid fa-map-marker-alt"></i> ${product.location}
            </h5>
            <a class="view-button" href="/product/${product.id}">View Product</a>
          </div>
        `;
                    productContainer.innerHTML += productCard;
                });

                // Update pagination controls
                pageNumber.innerText = data.current_page;
                prevButton.disabled = !data.has_prev;
                nextButton.disabled = !data.has_next;
            }

            // Handle category clicks
            document.querySelectorAll(".category-button").forEach(button => {
                button.addEventListener("click", function () {
                    const category = button.dataset.category || null;
                    fetchProducts(category, 1); // Reset to first page when changing category
                });
            });

            // Handle pagination
            nextButton.addEventListener("click", function () {
                if (!nextButton.disabled) {
                    fetchProducts(currentCategory, currentPage + 1);
                }
            });
            prevButton.addEventListener("click", function () {
                if (!prevButton.disabled) {
                    fetchProducts(currentCategory, currentPage - 1);
                }
            });

            // Initial load (fetch all products with pagination)
            fetchProducts();
        });
    </script>







{% endblock %}
